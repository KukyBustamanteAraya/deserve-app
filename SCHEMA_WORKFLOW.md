# Schema Reference Workflow

**Status:** ‚úÖ Migration-Free (as of 2025-10-11)

---

## üéØ The Golden Rule

**NEVER reference migration files for schema information.**

Migration files have been **DELETED**. The live Supabase database is the single source of truth.

---

## üìÅ Files

### 1. **SCHEMA_REFERENCE.sql**
- Contains the live schema structure
- Updated manually when schema changes
- Used as reference for development

### 2. **LIVE_SCHEMA.json**
- Auto-generated by `export-live-schema.mjs`
- Contains actual data samples
- Updated automatically via script

### 3. **scripts/query-schema.mjs**
- Query specific tables from live database
- Usage: `node scripts/query-schema.mjs [table_name]`

### 4. **scripts/export-live-schema.mjs**
- Export complete schema snapshot
- Usage: `node scripts/export-live-schema.mjs`

---

## üîÑ Workflow

### When You Need Schema Information:

**Option 1: Quick Table Query**
```bash
node scripts/query-schema.mjs sports
node scripts/query-schema.mjs teams
node scripts/query-schema.mjs all
```

**Option 2: Full Schema Export**
```bash
node scripts/export-live-schema.mjs
# Check LIVE_SCHEMA.json for complete data
```

**Option 3: Reference File**
- Check `SCHEMA_REFERENCE.sql` for structure
- This file is manually maintained

---

## üìù When Schema Changes in Supabase:

1. **Make changes** in Supabase Dashboard/SQL Editor
2. **Export the schema**:
   ```bash
   node scripts/query-schema.mjs [changed_table]
   ```
3. **Update SCHEMA_REFERENCE.sql** with the new structure
4. **Commit both files** with notes about what changed

---

## ‚úÖ Current Live Schema Summary

### Sports Table
```
4 sports in Spanish:
- futbol (F√∫tbol)
- basquetbol (B√°squetbol)
- voleibol (V√≥leibol)
- rugby (Rugby)
```

### Teams Table
```
Uses sport_id (FK to sports.id) - ACTIVE
Has sport (text) - Currently NULL
Has sports (text[]) - Currently NULL
```

### Product Types
```
2 types:
- jersey (Top)
- shorts (Bottom)
```

---

## üö´ What NOT to Do

‚ùå Don't check migration files for schema
‚ùå Don't assume schema from old migrations
‚ùå Don't hardcode values that come from database

## ‚úÖ What TO Do

‚úÖ Query live database via scripts
‚úÖ Use SCHEMA_REFERENCE.sql as reference
‚úÖ Update schema files when changes are made
‚úÖ Fetch dynamic data (like sports) from database

---

## üõ†Ô∏è Utility Commands

```bash
# Query a specific table
node scripts/query-schema.mjs sports

# Query multiple key tables
node scripts/query-schema.mjs all

# Full schema export with samples
node scripts/export-live-schema.mjs

# View the exported data
cat LIVE_SCHEMA.json | jq .
```

---

## üìä Schema Update Checklist

When Supabase schema changes:

- [ ] Run query script for changed table(s)
- [ ] Update SCHEMA_REFERENCE.sql
- [ ] Run full export: `node scripts/export-live-schema.mjs`
- [ ] Verify LIVE_SCHEMA.json has updated data
- [ ] Update any hardcoded values in code
- [ ] Test affected features
- [ ] Commit all changes

---

Last Updated: 2025-10-11
