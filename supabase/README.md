# Supabase Schema Management

**Date:** 2025-10-11
**Status:** ✅ Migration-Free Workflow

---

## 🎯 Our Approach: Live Schema Export (No Migrations)

We **DO NOT use migration files**. Instead, we use **live schema exports** as the single source of truth.

---

## 📋 Why No Migrations?

1. **Schema changes made directly in Supabase** (SQL Editor/Dashboard)
2. **Manual changes would break migration chain**
3. **Live database IS the source of truth**
4. **Simpler, clearer, no drift**

---

## 📁 Schema Reference Files

### **Primary References:**
- **`SCHEMA_REFERENCE.sql`** (root directory)
  - Human-readable schema documentation
  - Updated manually after schema changes
  - Current state of all tables, columns, constraints

- **`LIVE_SCHEMA.json`** (root directory)
  - Auto-generated full export
  - Includes sample data
  - Generated by `scripts/export-live-schema.mjs`

---

## 🔧 Tools

### **Export Full Schema**
```bash
node scripts/export-live-schema.mjs
```
Generates: `LIVE_SCHEMA.json` with all tables and sample data

### **Query Specific Table**
```bash
node scripts/query-schema.mjs sports
node scripts/query-schema.mjs teams
node scripts/query-schema.mjs all
```
Outputs: Live table data from Supabase

---

## 📝 Workflow: Making Schema Changes

### 1. **Make Changes in Supabase**
   - Open Supabase Dashboard → SQL Editor
   - Write and run your SQL DDL:
     ```sql
     ALTER TABLE teams ADD COLUMN new_field TEXT;
     ```

### 2. **Export Updated Schema**
   ```bash
   node scripts/export-live-schema.mjs
   ```

### 3. **Update SCHEMA_REFERENCE.sql**
   - Copy the new/modified table definition
   - Update the human-readable docs
   - Add notes about the change

### 4. **Commit Changes**
   ```bash
   git add SCHEMA_REFERENCE.sql LIVE_SCHEMA.json
   git commit -m "Schema: Added new_field to teams table"
   ```

---

## 🤖 For Claude/AI Assistants

**IMPORTANT RULES:**
1. ✅ **ALWAYS** use `SCHEMA_REFERENCE.sql` or `LIVE_SCHEMA.json` as the source of truth
2. ❌ **NEVER** reference migration files (they don't exist!)
3. ✅ **ALWAYS** provide SQL DDL statements for user to run in Supabase
4. ❌ **NEVER** create migration files
5. ✅ **ALWAYS** ask user to export schema after changes

---

## 📊 Current State

**Last Export:** Check `LIVE_SCHEMA.json` timestamp
**Tables:** See `SCHEMA_REFERENCE.sql`
**Data Samples:** See `LIVE_SCHEMA.json`

---

## 🔑 Key Benefits

| Benefit | Explanation |
|---------|-------------|
| ✅ **Single Source of Truth** | Supabase database IS the truth |
| ✅ **No Drift** | Reference always matches reality |
| ✅ **Simpler** | No migration ordering/conflicts |
| ✅ **Safer** | Can't run wrong migrations |
| ✅ **Clearer** | Explicit current state, not derived |

---

## 🚨 Important Notes

- **Supabase has automatic backups** - your data is safe
- **Schema reference files are for documentation only** - not executable
- **Always test schema changes in development first**
- **Export schema after EVERY change** to keep docs in sync

---

## 📚 Related Documentation

- **`/SCHEMA_REFERENCE.sql`** - Schema docs
- **`/LIVE_SCHEMA.json`** - Full export
- **`/SCHEMA_WORKFLOW.md`** - Detailed workflow guide
- **`/scripts/export-live-schema.mjs`** - Export tool
- **`/scripts/query-schema.mjs`** - Query tool

---

**This approach keeps our schema documentation accurate, simple, and always up-to-date!**
